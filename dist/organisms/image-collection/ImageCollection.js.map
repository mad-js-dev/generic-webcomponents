{"version":3,"file":"ImageCollection.js","sources":["../../../src/components/organisms/image-collection/ImageCollection.js"],"sourcesContent":["import { CollapsibleItem } from '../../molecules/collapsible-item/CollapsibleItem.js';\n\nexport class ImageCollection extends HTMLElement {\n    static get observedAttributes() {\n        return ['images'];\n    }\n\n    constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n        this._images = [];\n        this._handleToggle = this._handleToggle.bind(this);\n        this._currentOpenIndex = 0;\n    }\n\n    get images() {\n        return this._images;\n    }\n\n    set images(value) {\n        if (Array.isArray(value)) {\n            this._images = value;\n            this.render();\n        } else if (typeof value === 'string') {\n            try {\n                this._images = JSON.parse(value);\n                this.render();\n            } catch (e) {\n            }\n        }\n    }\n\n    connectedCallback() {\n        this.render();\n        this.shadowRoot.addEventListener('toggle', this._handleToggle);\n    }\n\n    disconnectedCallback() {\n        this.shadowRoot.removeEventListener('toggle', this._handleToggle);\n    }\n\n    _handleToggle(event) {\n        // Prevent event from bubbling up\n        event.stopPropagation();\n        \n        // Prevent reentrant calls\n        if (this._isHandlingToggle) return;\n        this._isHandlingToggle = true;\n        \n        let index = -1;\n        let wasExpanded = false;\n        \n        try {\n            \n            // Find the clicked collapsible item by traversing up the composed path\n            const target = event.composedPath().find(\n                node => node.nodeType === Node.ELEMENT_NODE && \n                       node.getAttribute && \n                       node.getAttribute('is') === 'collapsible-item'\n            );\n            \n            if (!target) {\n                return;\n            }\n\n            // Get all collapsible items\n            const allItems = Array.from(this.shadowRoot.querySelectorAll('li[is=\"collapsible-item\"]'));\n            index = allItems.indexOf(target);\n            \n            if (index === -1) {\n                return;\n            }\n            \n            // Prevent toggling if this item is already open\n            if (index === this._currentOpenIndex) {\n                return;\n            }\n            \n            wasExpanded = target.expanded;\n            \n            // Update all items\n            \n            // First, close all items except the target\n            allItems.forEach((item, i) => {\n                if (i !== index && item.expanded) {\n                    item.expanded = false;\n                }\n            });\n            \n            // Then toggle the target item if needed\n            if (index === this._currentOpenIndex) {\n                // Clicked the currently open item - close it\n                target.expanded = false;\n                this._currentOpenIndex = -1;\n            } else {\n                // Open the clicked item\n                target.expanded = true;\n                this._currentOpenIndex = index;\n            }\n        } finally {\n            // Always clear the flag, even if an error occurred\n            this._isHandlingToggle = false;\n        }\n        \n        // Dispatch our custom event\n        this.dispatchEvent(new CustomEvent('toggle', {\n            detail: { \n                index,\n                expanded: !wasExpanded,\n                source: 'image-collection'\n            },\n            bubbles: true,\n            composed: true\n        }));\n    }\n\n    \n    _onItemToggle(event) {\n        // Stop propagation to prevent double-handling\n        event.stopPropagation();\n        \n        const targetItem = event.target.closest('li[is=\"collapsible-item\"]');\n        if (!targetItem) return;\n\n        const items = Array.from(this.shadowRoot.querySelectorAll('li[is=\"collapsible-item\"]'));\n        const index = items.indexOf(targetItem);\n        \n        if (index === -1) return;\n\n        // If the clicked item is being closed, just update our state\n        if (!event.detail.expanded) {\n            if (this._currentOpenIndex === index) {\n                this._currentOpenIndex = -1;\n            }\n            return;\n        }\n\n        // Close the previously open item if it's different from the clicked one\n        if (this._currentOpenIndex !== -1 && this._currentOpenIndex !== index) {\n            const previousItem = items[this._currentOpenIndex];\n            if (previousItem) {\n                previousItem.toggle(false);\n            }\n        }\n        \n        this._currentOpenIndex = index;\n    }\n\n    render() {\n        if (!this.shadowRoot) return;\n        \n        // Only expand the first item if no item is currently expanded\n        if (this._currentOpenIndex === -1 && this._images.length > 0) {\n            this._currentOpenIndex = 0;\n        }\n        \n        this.shadowRoot.innerHTML = `\n            <style>\n                .image-collection {\n                    width: 100%;\n                    max-width: 800px;\n                    margin: 0 auto;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n                }\n                \n                .image-collection__container {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 0;\n                    width: 100%;\n                    list-style: none;\n                    padding: 0;\n                }\n                \n                .image-collection__item {\n                    width: 100%;\n                    border: 1px solid #e2e8f0;\n                    border-radius: 4px;\n                    overflow: hidden;\n                }\n                \n                .image-collection__image {\n                    width: 100%;\n                    height: auto;\n                    display: block;\n                }\n                \n                .image-collection__title {\n                    font-weight: 600;\n                    padding: 0.8rem 1rem;\n                    background-color: #f8fafc;\n                    width: 100%;\n                    cursor: pointer;\n                    transition: background-color 0.2s;\n                }\n                \n                .image-collection__title:hover {\n                    background-color: #f1f5f9;\n                }\n                \n                .image-collection .collapsible-item__header {\n                    padding: 0.5rem 1rem;\n                    background: none;\n                    border: none;\n                    width: 100%;\n                    text-align: left;\n                    cursor: pointer;\n                }\n                \n                .image-collection .collapsible-item__content {\n                    margin: 0;\n                    transition: all 0.3s ease;\n                }\n                \n                .image-collection li[is=\"collapsible-item\"] {\n                    border: 1px solid #e2e8f0;\n                    border-radius: 4px;\n                    overflow: hidden;\n                }\n                \n                .image-collection li[is=\"collapsible-item\"]:last-child {\n                    margin-bottom: 0;\n                }\n            </style>\n            <div class=\"image-collection\">\n                <ul class=\"image-collection__container\">\n                    ${this._images.map((image, index) => `\n                        <li is=\"collapsible-item\" \n                            label=\"${image.title}\" \n                            ${image.removeshift ? 'removeshift=\"true\"' : ''}\n                            ${this._currentOpenIndex === index ? 'expanded' : ''}\n                            hide-icon\n                            >\n                            <div slot=\"content\">\n                                <img \n                                    class=\"image-collection__image\" \n                                    src=\"${image.src}\" \n                                    alt=\"${image.title}\"\n                                    loading=\"lazy\"\n                                >\n                            </div>\n                        </li>\n                    `).join('')}\n                </ul>\n            </div>\n        `;\n    }\n}\n\nif (!customElements.get('image-collection')) {\n    customElements.define('image-collection', ImageCollection);\n}"],"names":["ImageCollection","value","event","index","wasExpanded","target","node","allItems","item","i","targetItem","items","previousItem","image"],"mappings":";AAEO,MAAMA,UAAwB,YAAY;AAAA,EAC7C,WAAW,qBAAqB;AAC5B,WAAO,CAAC,QAAQ;AAAA,EACxB;AAAA,EAEI,cAAc;AACV,UAAO,GACP,KAAK,aAAa,EAAE,MAAM,OAAM,CAAE,GAClC,KAAK,UAAU,CAAE,GACjB,KAAK,gBAAgB,KAAK,cAAc,KAAK,IAAI,GACjD,KAAK,oBAAoB;AAAA,EACjC;AAAA,EAEI,IAAI,SAAS;AACT,WAAO,KAAK;AAAA,EACpB;AAAA,EAEI,IAAI,OAAOC,GAAO;AACd,QAAI,MAAM,QAAQA,CAAK;AACnB,WAAK,UAAUA,GACf,KAAK,OAAQ;AAAA,aACN,OAAOA,KAAU;AACxB,UAAI;AACA,aAAK,UAAU,KAAK,MAAMA,CAAK,GAC/B,KAAK,OAAQ;AAAA,MAChB,QAAW;AAAA,MACxB;AAAA,EAEA;AAAA,EAEI,oBAAoB;AAChB,SAAK,OAAQ,GACb,KAAK,WAAW,iBAAiB,UAAU,KAAK,aAAa;AAAA,EACrE;AAAA,EAEI,uBAAuB;AACnB,SAAK,WAAW,oBAAoB,UAAU,KAAK,aAAa;AAAA,EACxE;AAAA,EAEI,cAAcC,GAAO;AAKjB,QAHAA,EAAM,gBAAiB,GAGnB,KAAK,kBAAmB;AAC5B,SAAK,oBAAoB;AAEzB,QAAIC,IAAQ,IACRC,IAAc;AAElB,QAAI;AAGA,YAAMC,IAASH,EAAM,aAAY,EAAG;AAAA,QAChC,CAAAI,MAAQA,EAAK,aAAa,KAAK,gBACxBA,EAAK,gBACLA,EAAK,aAAa,IAAI,MAAM;AAAA,MACtC;AAED,UAAI,CAACD;AACD;AAIJ,YAAME,IAAW,MAAM,KAAK,KAAK,WAAW,iBAAiB,2BAA2B,CAAC;AAQzF,UAPAJ,IAAQI,EAAS,QAAQF,CAAM,GAE3BF,MAAU,MAKVA,MAAU,KAAK;AACf;AAGJ,MAAAC,IAAcC,EAAO,UAKrBE,EAAS,QAAQ,CAACC,GAAMC,MAAM;AAC1B,QAAIA,MAAMN,KAASK,EAAK,aACpBA,EAAK,WAAW;AAAA,MAEpC,CAAa,GAGGL,MAAU,KAAK,qBAEfE,EAAO,WAAW,IAClB,KAAK,oBAAoB,OAGzBA,EAAO,WAAW,IAClB,KAAK,oBAAoBF;AAAA,IAEzC,UAAkB;AAEN,WAAK,oBAAoB;AAAA,IACrC;AAGQ,SAAK,cAAc,IAAI,YAAY,UAAU;AAAA,MACzC,QAAQ;AAAA,QACJ,OAAAA;AAAA,QACA,UAAU,CAACC;AAAA,QACX,QAAQ;AAAA,MACX;AAAA,MACD,SAAS;AAAA,MACT,UAAU;AAAA,IACtB,CAAS,CAAC;AAAA,EACV;AAAA,EAGI,cAAcF,GAAO;AAEjB,IAAAA,EAAM,gBAAiB;AAEvB,UAAMQ,IAAaR,EAAM,OAAO,QAAQ,2BAA2B;AACnE,QAAI,CAACQ,EAAY;AAEjB,UAAMC,IAAQ,MAAM,KAAK,KAAK,WAAW,iBAAiB,2BAA2B,CAAC,GAChFR,IAAQQ,EAAM,QAAQD,CAAU;AAEtC,QAAIP,MAAU,IAGd;AAAA,UAAI,CAACD,EAAM,OAAO,UAAU;AACxB,QAAI,KAAK,sBAAsBC,MAC3B,KAAK,oBAAoB;AAE7B;AAAA,MACZ;AAGQ,UAAI,KAAK,sBAAsB,MAAM,KAAK,sBAAsBA,GAAO;AACnE,cAAMS,IAAeD,EAAM,KAAK,iBAAiB;AACjD,QAAIC,KACAA,EAAa,OAAO,EAAK;AAAA,MAEzC;AAEQ,WAAK,oBAAoBT;AAAA;AAAA,EACjC;AAAA,EAEI,SAAS;AACL,IAAK,KAAK,eAGN,KAAK,sBAAsB,MAAM,KAAK,QAAQ,SAAS,MACvD,KAAK,oBAAoB,IAG7B,KAAK,WAAW,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAsEd,KAAK,QAAQ,IAAI,CAACU,GAAOV,MAAU;AAAA;AAAA,qCAEpBU,EAAM,KAAK;AAAA,8BAClBA,EAAM,cAAc,uBAAuB,EAAE;AAAA,8BAC7C,KAAK,sBAAsBV,IAAQ,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAMrCU,EAAM,GAAG;AAAA,2CACTA,EAAM,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,qBAKjC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,EAI/B;AACA;AAEK,eAAe,IAAI,kBAAkB,KACtC,eAAe,OAAO,oBAAoBb,CAAe;"}